{% load leaflet_tags %}
<head>
    {% leaflet_js %}
    {% leaflet_css %}
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <style>

        .leaflet-container { /* all maps */
            width: 100%;
            height: 100%;
        }

        #specialbigmap {
            height: 800px;
        }

        /* Resize the "display_raw" textbox */
        .django-leaflet-raw-textarea {
            width: 100%;
        }

    </style>
</head>

<body>
{% leaflet_map "piscines" callback="main_map_init" %}
<script type="text/javascript">
    const treesLayer = new L.LayerGroup()
    const swimmingpoolLayer = new L.layerGroup()
    const locationsLayer = new L.LayerGroup()
    const buildingLayer = new L.layerGroup()

    const overlays = {
        "Arbres": treesLayer,
        "Piscine": swimmingpoolLayer,
        "Emplacement": locationsLayer,
        "Batiments": buildingLayer
    }

    const baseLayers = {
        //"OpenTopo": OpenStreetMap_CH
    }

    function main_map_init(map, options) {
        const trees = '{% url "treesjson" %}'
        $.getJSON(trees, function (data) {
            L.geoJson(data, {onEachFeature: onEachFeature}).addTo(treesLayer);
        });

        const swimmingpools = '{% url "swimmingpoolsjson" %}'
        $.getJSON(swimmingpools, function (data) {
            L.geoJson(data, {
                onEachFeature: onEachFeature,
                style: {
                    fillColor: "#7ed6df",
                    fillOpacity: 1,
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                }
            }).addTo(swimmingpoolLayer);
        });

        const locations = '{% url "locationsjson" %}'
        $.getJSON(locations, function (data) {
            L.geoJson(data, {
                onEachFeature: onEachFeature,
                style: style
            }).addTo(locationsLayer);
        });

        const buildings = '{% url "buildingsjson" %}'
        $.getJSON(buildings, function(data) {
            L.geoJson(data, {
                onEachFeature: onEachFeature,
                style: {
                    fillColor: "#535c68",
                    fillOpacity: 1,
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                }
            }).addTo(buildingLayer);
        });

        const campingareas = '{% url "campingareasjson" %}'
        $.getJSON(campingareas, function (data) {
            L.geoJson(data, {
                onEachFeature: onEachFeature,
                style: {
                    fillColor: "#f6e58d",
                    fillOpacity: 1,
                    weight: 2,
                    opacity: 1,
                    color: "#f6e58d"
                }
            }).addTo(map);
        });

        //set active layer
        locationsLayer.addTo(map)

        L.control.layers(baseLayers, overlays).addTo(map);
    }

    function onEachFeature(feature, layer) {
        if (feature.properties && feature.properties.name) {
            layer.bindPopup(feature.properties.name);
        }
    }

    function isBusy(bookings){
        return Math.random() >= 0.4;
    }

    function style(feature) {
        return {
            fillColor: isBusy(feature.properties) ? "#6ab04c" : "#eb4d4b",
            fillOpacity: 1,
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3'
        };
    }
</script>
</body>
